<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BitLoTop Airdrop</title>
<style>
  body { font-family: system-ui, sans-serif; max-width: 700px; margin: 20px auto; background:#fafafa; color:#222; }
  h1 { font-size: 1.8em; margin-bottom: 5px; }
  button { padding: 10px 16px; border: none; border-radius: 8px; background: #007bff; color: #fff; cursor: pointer; }
  button:hover { background: #0056b3; }
  textarea, input, select { width: 100%; padding: 8px; margin: 6px 0; border-radius: 6px; border: 1px solid #ccc; }
  #log { background: #111; color: #0f0; padding: 10px; border-radius: 6px; height: 180px; overflow-y: auto; font-family: monospace; font-size: 13px; }
  .row { display: flex; gap: 6px; flex-wrap: wrap; align-items: center; }
</style>
</head>
<body>
<h1>BitLoTop Airdrop</h1>
<p>Private airdrop tool â€” sequential sends with batch preview & gas estimation.</p>

<button id="connectBtn">Connect Wallet</button>
<div id="walletInfo"></div>

<hr>

<h3>Token to send</h3>
<input id="tokenAddress" placeholder="Token contract (BEP20)" />
<button id="loadToken">Load token</button>
<div id="tokenInfo"></div>

<hr>

<!-- ðŸ†• RPC + GAS CONTROLS -->
<h3>RPC / Gas Settings</h3>
<label for="rpcSelect">RPC Endpoint:</label>
<div class="row">
  <select id="rpcSelect">
    <option value="https://bsc-dataseed.binance.org">Default â€” Binance RPC</option>
    <option value="https://bsc-dataseed1.defibit.io">Defibit RPC</option>
    <option value="https://bsc-dataseed1.ninicoin.io">Ninicoin RPC</option>
    <option value="https://bsc-dataseed1.bnbchain.org">BNBChain RPC</option>
    <option value="">Custom (paste below)</option>
  </select>
</div>
<input id="rpcCustom" placeholder="https://your-rpc-url.com" />

<div class="row">
  <label for="manualGas">Gas price (Gwei):</label>
  <input id="manualGas" type="number" step="0.1" placeholder="Auto">
</div>

<hr>

<h3>Recipients</h3>
<textarea id="recipients" rows="8" placeholder="0xabc...,1.0"></textarea>
<div id="summary"></div>

<button id="previewBtn">Preview</button>
<button id="airdropBtn">Start Airdrop</button>

<h3>Logs</h3>
<pre id="log"></pre>

<script src="ethers.umd.min.js"></script>
<script>
let provider, signer, account, tokenContract, tokenDecimals=18, tokenSymbol='TKN';
const log = (...args)=>{document.getElementById('log').textContent += args.join(' ') + '\\n'};

// ðŸ†• Helper to get selected RPC and manual gas
function getRpcUrl() {
  const sel = document.getElementById('rpcSelect').value.trim();
  const custom = document.getElementById('rpcCustom').value.trim();
  return custom || sel || 'https://bsc-dataseed.binance.org';
}
function getManualGasWei() {
  const val = document.getElementById('manualGas').value.trim();
  if(!val) return null;
  const gwei = parseFloat(val);
  if(isNaN(gwei) || gwei <= 0) return null;
  return '0x' + (BigInt(Math.round(gwei * 1e9))).toString(16);
}

async function connect() {
  if (!window.ethereum) return alert("MetaMask required");
  await window.ethereum.request({ method: "eth_requestAccounts" });
  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  account = await signer.getAddress();
  const bal = await provider.getBalance(account);
  document.getElementById('walletInfo').innerHTML = 
    `Connected: ${account}<br>BNB: ${ethers.formatEther(bal)}`;
  log("Connected wallet", account);
}

async function loadToken() {
  const addr = document.getElementById('tokenAddress').value.trim();
  if(!addr) return alert("Enter token address");
  const abi = [
    "function symbol() view returns (string)",
    "function decimals() view returns (uint8)",
    "function balanceOf(address) view returns (uint256)",
    "function transfer(address,uint256) returns (bool)"
  ];
  tokenContract = new ethers.Contract(addr, abi, signer);
  tokenSymbol = await tokenContract.symbol();
  tokenDecimals = await tokenContract.decimals();
  const bal = await tokenContract.balanceOf(account);
  document.getElementById('tokenInfo').innerHTML = 
    `${tokenSymbol} (${tokenDecimals} decimals)<br>Your token balance: ${ethers.formatUnits(bal, tokenDecimals)}`;
  log("Token loaded", tokenSymbol, "decimals", tokenDecimals);
}

document.getElementById('connectBtn').onclick = connect;
document.getElementById('loadToken').onclick = loadToken;

document.getElementById('previewBtn').onclick = ()=>{
  const lines = document.getElementById('recipients').value.trim().split(/\\n+/);
  const valid = lines.filter(l=>/^0x[a-fA-F0-9]{40},/.test(l));
  document.getElementById('summary').innerHTML = `Recipients: ${valid.length}`;
};

document.getElementById('airdropBtn').onclick = sendAirdrop;

async function sendAirdrop() {
  const lines = document.getElementById('recipients').value.trim().split(/\\n+/);
  const valid = lines.filter(l=>/^0x[a-fA-F0-9]{40},/.test(l));
  if(valid.length===0) return alert("No valid addresses");

  log("Starting airdrop...");
  const manualGas = getManualGasWei();

  for (const line of valid) {
    const [addr, amountStr] = line.split(',');
    const amount = ethers.parseUnits(amountStr.trim(), tokenDecimals);
    const data = tokenContract.interface.encodeFunctionData("transfer",[addr,amount]);

    const txParams = { from: account, to: tokenContract.target, data: data };
    if (manualGas) {
      txParams.gasPrice = manualGas;
      log("Using manual gas price:", manualGas);
    }

    try {
      const est = await provider.estimateGas(txParams);
      txParams.gasLimit = est + 5000n;
      const tx = await signer.sendTransaction(txParams);
      log("Tx sent:", tx.hash);
      const rcpt = await tx.wait();
      log("Confirmed:", rcpt.hash);
    } catch(e) {
      log("Error:", e.message);
    }
  }
  log("Airdrop complete.");
}
</script>
</body>
</html>
